<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width" />
    <meta http-equiv="content-type" content="text/html;charset=utf-8">
    <title>用户信息</title>
     <link href="../../style/bootstrap.min.css" rel="stylesheet" />
    <link href="../../style/animate.css" rel="stylesheet" />
    <script src="../../js/jquery.min.js"></script>
    <script src="../../js/url_zhuan.js"> </script>
    <link href="../../style/validationEngine.jquery.css" rel="stylesheet"/>
    <link href="../../style/Form.css" rel="stylesheet" />
    <script src="../../js/jquery.form.js"  type="text/javascript"></script>
    <script src="../../js/FTool.js"  type="text/javascript"></script>

    <script type="text/javascript">
        function checkHELLO(field, rules, i, options) {
            if (!/^(13[0-9]|14[0-9]|15[0-9]|16[0-9]|17[0-9]|18[0-9]|19[0-9])\d{8}$/i.test(field.val())) {
                return "请输入有效的手机号码";
            }
        }
    </script>
    

     <link href="../../style/MDForm.css" rel="stylesheet" />

</head>
<body >
<div class="bodyBox">
        
    <form action="" class="form-horizontal" id="editForm" method="post">    
        <div class="formBody" id="formBody">
            <!--//readonly='readonly'  只读-->
            <div class="form-group">
                <label class="control-label col-xs-3 " for="realName">姓名</label>
                <div class="col-xs-9"> 
                    <input class="form-control  " id="realName" name="realName" type="text" value="用户名" />
                </div>
            </div>
            <div class="form-group">
                <label class="control-label col-xs-3 " for="address">地址</label>
                <div class="col-xs-9">
                    <input class="form-control" id="address" name="address" type="text" value="广东省深圳市龙华区油联路65号U创谷" />
                </div>
            </div>
            <div class="form-group">
                <label class="control-label col-xs-3 " for="phone">电话</label>
                <div class="col-xs-9">
                    <input class="form-control "   id="phone" name="phone" type="text" value="13215945685" />
                </div>
            </div>
            <div class="form-group">
                <label class="control-label col-xs-3 " for="companyPhone">防火员电话</label>
                <div class="col-xs-9">
                    <input class="form-control "    id="companyPhone" name="companyPhone" type="text" value="0755-51254583"/>
                </div>
            </div>
            <div class="form-group">
                <label class="control-label col-xs-3 " for="company">公司名称</label>
                <div class="col-xs-9">
                    <input class="form-control"   id="company" name="company" type="text" value="港深" />
                </div>
            </div>
            <div class="form-group">
                <label class="control-label col-xs-3 " for="mobile">邮箱</label>
                <div class="col-xs-9">
                    <input class="form-control "   id="mobile" name="mobile" type="text" value="5245061@qq.com" />
                </div>
            </div>
            <div class="form-group" >
                <label class="control-label col-xs-3 " for="mobile">选择角色</label>
                <div class="col-xs-9" >
                    <select name="" id="colorName" class="form-control ">
                    
                    </select>
                </div>
            </div>
            <div class="form-group">
                <label class="control-label col-xs-3 " for="mobile">下级单位可选择使用角色</label>
                <div class="col-xs-9" >
                        <div class="col-xs-12" id="childJur">
                            <!-- <label class="col-xs-6">
                                <input type="checkbox" name="thirdMenuIdList"
                                    value="10003004">&nbsp;
                                设备远程停机/开机 
                                <input type="hidden" id="menuAlias_10003004" value="设备远程停机">
                            </label> -->
                        </div>
                        
                    </div>
            </div>
        </div>
        <!-- onclick="window.top.CloseCurrWin()" -->
        <div class="formBut">
            <div class="form-group">   <div style="float:right;margin-right:30px;">     <input class="btn btn-primary"  name="submitBtn" type="button" value="保存" id="Edit_save" />     <input class="btn btn-default"  name="goBackBtn"  type="button" value="关闭" id="btn_close"/>  </div>   <div class="checkbox" style="float:right;margin-right:30px;">       <label>
            <input data-val="true" data-val-number="字段 GUID 必须是一个数字。" id="ID" name="ID" type="hidden" value="" />
        
        
        </div>
    </form>

        
</div>
        <!--<script src="../../js/jquery.validationEngine-zh.js"></script>
        <script src="../../js/jquery.validationEngine.js"></script>-->
        <script src="../../js/bootstrap.min.js"></script>
<script>  
    var username=localStorage.getItem('userName');
    var powerId=localStorage.getItem('new_role');
    console.log(decodeURI($('#ediModelIfm').context.URL))
    var role = localStorage.getItem('role');
    var global = (function () {
        var search = location.search;
        var search = decodeURI(search);
        var global = {};
        if (search != "") {
            search.slice(1).split("&").forEach(function (val) {
                var arr = val.split("=");
                global[arr[0]] = arr[1];
            });
        }
        return global;
    })();
    console.log(global);
    var powerOther=global.powerOther;
    if(powerOther=='0'){
        var powerOther="";
    }else{
        var powerOther=global.powerOther;
    }
    console.log(powerOther)
    var new_role=global.new_role;
    if(new_role=='0'){
        var new_role="";
    }else{
        var new_role=global.new_role;
    }
    var arr=[];
    if(powerOther!=""){
        var powerPid=powerOther.split(',');
        for(var i=0;i<powerPid.length;i++){
             arr.push(powerPid[i])
        }
    }
    console.log(arr)

    var html="";
    if(powerId==1000){
        html="<div class= 'form-group '><label class= 'control-label col-xs-3  ' for= 'realName '>姓名</label><div class= 'col-xs-9 '> <input class= 'form-control   ' id= 'realName' name= 'realName ' type= 'text ' value= ' "+global.realName+"' /></div></div><div class= 'form-group '><label class= 'control-label col-xs-3  ' for= 'address '>地址</label><div class= 'col-xs-9 '><input class= 'form-control ' id= 'address' name= 'address ' type= 'text ' value= '"+global.address+"' /></div></div><div class= 'form-group '><label class= 'control-label col-xs-3  ' for= 'phone '>电话</label> <div class= 'col-xs-9 '><input class= 'form-control  '   id= 'phone' name= 'phone ' type= 'text ' value= '"+global.phone+" ' /></div></div><div class= 'form-group '><label class= 'control-label col-xs-3  ' for= 'companyPhone '>公司电话</label><div class= 'col-xs-9 '><input class= 'form-control  '    id= 'companyPhone' name= 'companyPhone ' type= 'text ' value= '"+global.company_phone+" '/></div></div><div class= 'form-group '><label class= 'control-label col-xs-3  ' for= 'company '>公司名称</label><div class= 'col-xs-9 '><input class= 'form-control '   id= 'company' name= 'company ' type= 'text ' value= '"+global.company+" ' /> </div></div><div class= 'form-group '><label class= 'control-label col-xs-3  ' for= 'mobile '>邮箱</label><div class= 'col-xs-9 '><input class= 'form-control  '   id= 'mobile' name= 'mobile ' type= 'text ' value= '"+global.mobile+"' /></div></div><div class='form-group' ><label class='control-label col-xs-3 ' for='mobile'>选择角色</label><div class='col-xs-9' ><select name='' id='colorName' class='form-control ' value="+global.new_role+"> </select></div><div class=' col-xs-3 '></div></div><div class='form-group'><label class='control-label col-xs-3 ' for='mobile'>下级单位可选择使用角色</label><div class='col-xs-9' ><div class='col-xs-12' id='childJur'></div></div></div>";
    }else{
        html="<div class= 'form-group '><label class= 'control-label col-xs-3  ' for= 'realName '>姓名</label><div class= 'col-xs-9 '> <input class= 'form-control   ' id= 'realName' name= 'realName ' type= 'text ' value= ' "+global.realName+"' /></div></div><div class= 'form-group '><label class= 'control-label col-xs-3  ' for= 'address '>地址</label><div class= 'col-xs-9 '><input class= 'form-control ' id= 'address' name= 'address ' type= 'text ' value= '"+global.address+"' /></div></div><div class= 'form-group '><label class= 'control-label col-xs-3  ' for= 'phone '>电话</label> <div class= 'col-xs-9 '><input class= 'form-control  '   id= 'phone' name= 'phone ' type= 'text ' value= '"+global.phone+" ' /></div></div><div class= 'form-group '><label class= 'control-label col-xs-3  ' for= 'companyPhone '>公司电话</label><div class= 'col-xs-9 '><input class= 'form-control  '    id= 'companyPhone' name= 'companyPhone ' type= 'text ' value= '"+global.company_phone+" '/></div></div><div class= 'form-group '><label class= 'control-label col-xs-3  ' for= 'company '>公司名称</label><div class= 'col-xs-9 '><input class= 'form-control '   id= 'company' name= 'company ' type= 'text ' value= '"+global.company+" ' /> </div></div><div class= 'form-group '><label class= 'control-label col-xs-3  ' for= 'mobile '>邮箱</label><div class= 'col-xs-9 '><input class= 'form-control  '   id= 'mobile' name= 'mobile ' type= 'text ' value= '"+global.mobile+"' /></div></div><div class='form-group' ><label class='control-label col-xs-3 ' for='mobile'>选择角色</label><div class='col-xs-9' ><select name='' id='colorName' class='form-control ' value="+global.new_role+"> </select></div></div>";
    }
    
    $('#formBody').html(html);

    var r_name="";
    function select(pno,pageSize){
        var powerOther="";
        $.ajax({
            type:'get',
            url:url+'/power/getPowerOther.action',
            data:'username='+username+'&role='+powerId+'&powerOther='+powerOther,
            error:function(error){console.log(error+'jur.js')},
            success:function(res){
                console.log(res);
                var data=res
                var html="";
                var chtml="";
                html="<option></option>"
                $.each(data,function(i,v){
                    html+="<option value='"+v.name+"' data-id='"+v.id+"' >"+v.name+"</option>";
                    chtml+="<label class='col-xs-6' style='padding:0;'><input type='checkbox' name='thirdMenuIdList'value='"+v.id+"' >&nbsp;"+v.name+" <input type='hidden' id='menuAlias_"+v.id+"' value='"+v.name+"'></label>";
                })
                $('#colorName').html(html);
                $('#childJur').html(chtml);
                
                for(var i=0;i<data.length;i++){
                    var id=global.new_role
                    var dataId=data[i].id
                    console.log(id)
                    console.log(dataId)
                    if(id!='0'){
                        if(dataId.indexOf(id) >=0 ==true){
                            console.log(1)
                            $('#colorName').val(data[i].name)
                        }
                    }else{
                        $('#colorName').val()
                    }
                    
                }
                if(powerId=='1000'){
                    var obj = document.getElementsByName("thirdMenuIdList");
                    console.log(obj)
                    var check_val = [];
                    var str=[];
                    for(var i=0;i<arr.length;i++){
                        console.log(arr[i]);
                        var dId=arr[i].split('/')[0]
                        str.push(dId);
                        
                    }
                    var dId=str.join(',')
                    console.log(dId)
                    for(var y=0;y<data.length;y++){
                        var objDate=data[y].id
                        if(dId.indexOf(objDate)>=0){
                            // console.log(obj[y].value+'--1')
                            obj[y].checked = true;
                        }else{
                            // console.log(obj[y].value+'--2')
                            obj[y].checked = false;
                        }
                    } 
                }
                
                
            }
        })
    }
    select(1,10000)
    $('#btn_close').click(function(){
        var index = parent.layer.getFrameIndex(window.name);
        parent.layer.close(index);
    })


    $('#Edit_save').click(function(){
       var realName =$('#realName').val();
       var address =$('#address').val();
       var phone =$('#phone').val();
       var company_phone =$('#companyPhone').val();
       var company =$('#company').val();
       var mobile =$('#mobile').val();
       var user_name=global.user_name;
       var obj = document.getElementsByName("thirdMenuIdList");
       console.log(obj)
        var check_val = [];
        for(var i=0;i<obj.length;i++){
            if(obj[i].checked==true){
                check_val.push(obj[i].value)
            }
        }
        console.log(check_val)
        var p_id = check_val.join(',');
       console.log(p_id);
       console.log(realName+'--'+address+'--'+phone+'--'+company_phone+'--'+company+'--'+mobile);
       console.log($('#colorName'))
       console.log($('#colorName').val())
       if($('#colorName').val()!=""){
        var id=$('#colorName option:selected').attr('data-id');
       }else{
           var id=""
       }      
        console.log(id)
       $.ajax({
           type:'get',
           url:url+'/admin/device/updateUser.action',
           data:'user_name='+user_name+'&realName='+realName+'&address='+address+'&phone='+phone+'&company_phone='+company_phone+'&company='+company+'&mobile='+mobile+'&power='+id+'&powerOther='+p_id,
           error:function(error){console.log(error)}, 
           success:function(result){
               var res=JSON.parse(result);
               console.log(res);
               if(res.list[0].status==true){
                    alert(res.list[0].mess);
                    // setTimeout(function(){
                    //     parent.location.reload();  //上一层页面跳转
                    // },100)
                    var index = parent.layer.getFrameIndex(window.name);
                    setTimeout(() => {
                        parent.layer.close(index);
                        // parent.location.reload();  //父级刷新
                        parent.location.reload();  //父级刷新
                    }, 100);
               }else{
                    alert(res.list[0].mess)
               }
           }
       })
    })

</script>
        
</body>
</html>
